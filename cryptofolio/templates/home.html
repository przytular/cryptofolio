{% extends 'base.html' %}

{% block title %} {{ user.username }}'s moonfolio {% endblock %}

{% block menuportfolios %}
<form style="margin-left:1rem;" onchange="submit();" class="form-inline mr-auto" action="{% url 'portfolio-change' %}">
    <select name='portfolio' class="form-control">
            <option value="---">default</option>
        {% for p in portfolio_list %}
            <option value="{{ p.pk }}" 
            {% if p.pk == request.user.userprofile.portfolio.pk %}selected{% endif %}>{{ p.name }}</option>
        {% endfor %}
    </select>
</form>
{% endblock menuportfolios %}
{% block content %}

{% load nvd3_tags %}
<head>
    {% if has_data == True %}
    {% include_chart_jscss %}
    {% load_chart fiat_piechart.charttype fiat_piechart.chartdata fiat_piechart.chartcontainer fiat_piechart.extra %}
    {% load_chart time_series.charttype time_series.chartdata time_series.chartcontainer time_series.extra %}
    {% endif %}
</head>
<body>
    {% if has_data == True %}
    <div class="row py-2">
        <div class="col-md-4">
            <label>
                <b>Cryptocurrency holdings:</b>
            </label>
        </div>
        <div class="col-md-8">
            <span>
                {{ fiat_sum }} {{ fiat }}
            </span>
        </div>
    </div>
    <div>
        <table class="table">
            <thead>
                <tr>
                    <th>Currency</th>
                    <th>Balance</th>
                    <th>Timestamp</th>
                    <th>Related addresses</th>
                    <th>Wallet holdings</th>
                    <th>Wallet description</th>
                </tr>
            </thead>
            <tbody>
                {% for balance in balances|dictsortreversed:"amount" %}
                <tr>
                    <td>{{ balance.currency }}</td>
                    <td>{{ balance.amount|floatformat:-8 }}</td>
                    <td>
                        {{ balance.timestamp }}
                    </td>
                    <td>
                        {% for addr in balance.addresses %}
                            <a target="_blank" href="{{ addr.block_explorer_link }}">{{ addr.address|truncatechars:34 }}&nbsp;<i class="fas fa-external-link-alt"></i></a><br/>
                        {% endfor %}
                    </td>
                    <td>
                        {% for addr in balance.addresses %}
                            {{ addr.amount }}&nbsp;{{ addr.currency }}<br/>
                        {% endfor %}
                    </td>
                    <td>
                        {% for addr in balance.addresses %}
                            {% if addr.description %}&nbsp;<small>{{ addr.description }}</small>{% endif %}<br/>
                        {% endfor %}
                    </td>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <hr>
    <div>
        <h3>Balances in {{ fiat }}</h3>
        {% include_container fiat_piechart.chartcontainer 400 '100%' %}
    </div>
    <hr>
    {% else %}
    <p>Nothing to show :(</p>
    <p>Please add API keys and secrets in <a href="{% url 'settings' %}">settings</a>!</p>
    {% endif %}
</body>

{% endblock %}

